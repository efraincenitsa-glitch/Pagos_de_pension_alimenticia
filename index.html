<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pensi√≥n PRO Privado</title>

<link rel="apple-touch-icon" sizes="1024x1024" href="icono.png">

<style>
body{
    font-family:Arial;
    background:#0f172a;
    color:white;
    text-align:center;
    padding:20px;
}

.card{
    background:#1e293b;
    padding:20px;
    border-radius:15px;
    max-width:420px;
    margin:auto;
    box-shadow:0 0 25px rgba(0,0,0,.6);
}

input,select,button{
    width:100%;
    padding:12px;
    margin:8px 0;
    border-radius:8px;
    border:none;
    font-size:16px;
}

button{
    background:#22c55e;
    color:white;
    font-weight:bold;
    cursor:pointer;
}

button:hover{
    background:#16a34a;
}

#logout{
    background:#ef4444;
}

#app{
    display:none;
}

table{
    width:100%;
    margin-top:15px;
    border-collapse:collapse;
}

td,th{
    border-bottom:1px solid #334155;
    padding:6px;
}

</style>
</head>

<body>

<h1>üîí Pensi√≥n PRO Privado</h1>

<!-- LOGIN -->
<div id="login" class="card">

    <h2>Acceso Privado</h2>

    <button id="googleLogin">
        üîê Iniciar con Google
    </button>

    <p>Solo autorizado para:<br>
    <b>jose.efrass@gmail.com</b></p>

</div>

<!-- APP -->
<div id="app" class="card">

    <h2>Control de Pagos</h2>

    <input id="ingreso" type="number" placeholder="Monto ganado">

    <input id="porcentaje" type="number" placeholder="Porcentaje (%)">

    <select id="periodo">
        <option value="Semanal">Semanal</option>
        <option value="Catorcenal">Catorcenal</option>
        <option value="Quincenal">Quincenal</option>
        <option value="Mensual">Mensual</option>
    </select>

    <button onclick="guardar()">Guardar pago</button>

    <button id="logout">Cerrar sesi√≥n</button>

    <h3>Historial</h3>

    <table id="tabla">
        <tr>
            <th>Fecha</th>
            <th>Pagar</th>
            <th>Libre</th>
        </tr>
    </table>

</div>

<!-- FIREBASE -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  signInWithPopup,
  signOut,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
  getFirestore,
  collection,
  addDoc,
  getDocs,
  query,
  orderBy
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


const firebaseConfig = {
  apiKey: "AIzaSyDTV8IdIsfFFU5X30dOckR5_9pmLqgidBY",
  authDomain: "pensionpro-1e559.firebaseapp.com",
  projectId: "pensionpro-1e559",
  storageBucket: "pensionpro-1e559.firebasestorage.app",
  messagingSenderId: "354313368373",
  appId: "1:354313368373:web:becef8b8ff21d51c58927c"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const EMAIL_AUTORIZADO = "jose.efrass@gmail.com";


// üîê LOGIN GOOGLE

document.getElementById("googleLogin").onclick = async () => {

    const provider = new GoogleAuthProvider();

    try{
        await signInWithPopup(auth, provider);
    }catch(e){
        alert("Error al iniciar sesi√≥n");
        console.error(e);
    }
};


// üîç VERIFICAR SESI√ìN

onAuthStateChanged(auth, user => {

    if(user){

        if(user.email !== EMAIL_AUTORIZADO){

            alert("‚õî No autorizado");
            signOut(auth);
            return;
        }

        document.getElementById("login").style.display="none";
        document.getElementById("app").style.display="block";

        cargar();

    }else{

        document.getElementById("login").style.display="block";
        document.getElementById("app").style.display="none";
    }
});


// üö™ LOGOUT

document.getElementById("logout").onclick = () => signOut(auth);


// üíæ GUARDAR EN LA NUBE

window.guardar = async () => {

    const ingreso = Number(document.getElementById("ingreso").value);
    const porcentaje = Number(document.getElementById("porcentaje").value);

    if(!ingreso || !porcentaje){
        alert("Completa los datos");
        return;
    }

    const pagar = ingreso * porcentaje / 100;
    const libre = ingreso - pagar;

    await addDoc(collection(db,"pagos"),{

        fecha: new Date().toLocaleString(),
        ingreso,
        porcentaje,
        pagar,
        libre
    });

    alert("Guardado en la nube ‚òÅÔ∏è");

    cargar();
};


// üìã CARGAR HISTORIAL

async function cargar(){

    const tabla = document.getElementById("tabla");

    tabla.innerHTML = `
        <tr>
            <th>Fecha</th>
            <th>Pagar</th>
            <th>Libre</th>
        </tr>`;

    const q = query(collection(db,"pagos"), orderBy("fecha"));

    const datos = await getDocs(q);

    datos.forEach(doc => {

        const d = doc.data();

        tabla.innerHTML += `
            <tr>
                <td>${d.fecha}</td>
                <td>$${d.pagar.toFixed(2)}</td>
                <td>$${d.libre.toFixed(2)}</td>
            </tr>`;
    });
}

</script>

</body>
</html>
