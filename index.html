<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pensi贸n PRO Privado</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Pensi贸n PRO">
<link rel="apple-touch-icon" sizes="1024x1024" href="icono-1024.png">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f172a;
  color:white;
  text-align:center;
}
.container{
  max-width:420px;
  margin:auto;
  padding:20px;
}
.card{
  background:#1e293b;
  padding:20px;
  border-radius:20px;
  box-shadow:0 0 25px rgba(0,0,0,0.5);
}
input,select{
  width:100%;
  padding:14px;
  margin:10px 0;
  border-radius:12px;
  border:none;
  font-size:16px;
}
button{
  width:100%;
  padding:14px;
  margin-top:10px;
  border:none;
  border-radius:12px;
  font-size:18px;
  font-weight:bold;
  color:white;
}
.green{background:#16a34a;}
.red{background:#ef4444;}
.blue{background:#2563eb;}
table{
  width:100%;
  margin-top:15px;
  border-collapse:collapse;
}
th,td{
  padding:10px;
  border-bottom:1px solid #334155;
}
</style>
</head>

<body>

<div class="container">

<h1> Pensi贸n PRO Privado</h1>

<button class="blue" onclick="login()">Acceso con Google</button>
<button class="red" onclick="logout()">Cerrar sesi贸n</button>

<div class="card">

<h2>Control de Pagos</h2>

<input id="monto" type="number" placeholder="Ingreso">
<input id="porcentaje" type="number" placeholder="Porcentaje">

<select id="periodo">
  <option>Semanal</option>
  <option>Catorcenal</option>
  <option selected>Quincenal</option>
  <option>Mensual</option>
</select>

<button class="green" onclick="guardar()">Guardar pago</button>

<h2>Historial</h2>

<table>
<thead>
<tr>
<th>Fecha</th>
<th>Pagar</th>
<th>Libre</th>
</tr>
</thead>
<tbody id="historial"></tbody>
</table>

</div>
</div>

<!-- FIREBASE SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>

//  PEGA AQU TU CONFIGURACIN
const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_PROYECTO.firebaseapp.com",
  projectId: "TU_PROYECTO",
  storageBucket: "TU_PROYECTO.appspot.com",
  messagingSenderId: "XXXX",
  appId: "XXXX"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

const correoPermitido = "jose.efrass@gmail.com";

// LOGIN
function login(){
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
}

// LOGOUT
function logout(){
  auth.signOut();
}

// CONTROL DE USUARIO
auth.onAuthStateChanged(user=>{
  if(!user) return;

  if(user.email !== correoPermitido){
    alert("Acceso denegado");
    logout();
    return;
  }

  cargarHistorial(user.uid);
});

// GUARDAR PAGO
async function guardar(){

  const user = auth.currentUser;
  if(!user) return alert("Debes iniciar sesi贸n");

  const monto = parseFloat(document.getElementById("monto").value);
  const porcentaje = parseFloat(document.getElementById("porcentaje").value);
  const periodo = document.getElementById("periodo").value;

  if(!monto || !porcentaje) return alert("Completa datos");

  const pagar = monto * porcentaje / 100;
  const libre = monto - pagar;

  const fecha = new Date().toLocaleDateString();

  await db.collection("pagos").add({
    uid:user.uid,
    fecha,
    monto,
    porcentaje,
    periodo,
    pagar,
    libre,
    timestamp:Date.now()
  });

  cargarHistorial(user.uid);
}

// CARGAR HISTORIAL
function cargarHistorial(uid){

  db.collection("pagos")
    .where("uid","==",uid)
    .orderBy("timestamp","desc")
    .onSnapshot(snapshot=>{

      const tabla = document.getElementById("historial");
      tabla.innerHTML="";

      snapshot.forEach(doc=>{
        const d = doc.data();

        tabla.innerHTML += `
          <tr>
            <td>${d.fecha}</td>
            <td>$${d.pagar.toFixed(2)}</td>
            <td>$${d.libre.toFixed(2)}</td>
          </tr>
        `;
      });

    });
}

</script>

</body>
</html>
